#!/usr/bin/env python3

from lib.attacks import *
from lib.client import MITMClient

if __name__ == "__main__":
    client = MITMClient()
    client.send(ClearCommand())

    jwks = JWKSSpoof()
    jwks.uri = "https://attack-idp.professos/modauthopenidc/jwks"

    # Test if null is handled correctly
    # Jansson as JSON backend is used
    # following message displayed: \u0000 is not allowed without JSON_ALLOW_NUL error msg in apache2/errors
    # also full jwk set is logged
    jwks.keys[0]["n"] = "\0<?php echo Hello ?>"

#    jwks.keys[0]["n"] = "\0"
#    for i in range(1,2000):
#        jwks.keys.append(jwks.keys[0])

    # curl easy used to retrieve json curl_easy_perform
    # integer overflow %lu > inputbuffer_size could not be triggered due to timeout 60000ms
    # jwks.keys[0]["n"] = "a"*4294967296

    keys = jwks.keys
    client.send(jwks)
